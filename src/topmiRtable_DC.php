<?php

// Fetch the disease category selected, influence method from the requesting Ajax call
$disCategorySelected = $_POST["disCategorySelected"];
$influenceMethodSelected = $_POST["influenceMethodSelected"]; // cumulative or intersection
$netGenMethod = $_POST["netGenMethod"]; //'netGenMethod': netGenMethod
$use_hashmap_flag = 0;

$mirna_int_hashmap = array("hsa-mir-183"=>1, "hsa-mir-374a"=>2, "hsa-mir-324"=>3, "hsa-mir-182"=>4, "hsa-mir-196b"=>5, "hsa-mir-222"=>6, "hsa-mir-23b"=>7, "hsa-mir-99a"=>8, "hsa-mir-339"=>9, "hsa-mir-220a"=>10, "hsa-mir-24-2"=>11, "hsa-mir-125b-2"=>12, "hsa-mir-92a-2"=>13, "hsa-mir-31"=>14, "hsa-mir-203"=>15, "hsa-mir-20a"=>16, "hsa-mir-26a-1"=>17, "hsa-mir-302c"=>18, "hsa-mir-137"=>19, "hsa-mir-634"=>20, "hsa-mir-145"=>21, "hsa-mir-143"=>22, "hsa-mir-122"=>23, "hsa-mir-138-1"=>24, "hsa-mir-323"=>25, "hsa-mir-27a"=>26, "hsa-mir-224"=>27, "hsa-mir-187"=>28, "hsa-mir-7-2"=>29, "hsa-mir-30e"=>30, "hsa-mir-219-1"=>31, "hsa-mir-148b"=>32, "hsa-mir-155"=>33, "hsa-mir-16-1"=>34, "hsa-mir-19a"=>35, "hsa-mir-367"=>36, "hsa-mir-148a"=>37, "hsa-mir-328"=>38, "hsa-mir-342"=>39, "hsa-mir-197"=>40, "hsa-mir-93"=>41, "mmu-mir-1-1"=>42, "mmu-mir-133a-1"=>43, "mmu-mir-183"=>44, "mmu-mir-96"=>45, "hsa-mir-380"=>46, "hsa-mir-1-2"=>47, "hsa-mir-205"=>48, "hsa-mir-30c-1"=>49, "hsa-mir-215"=>50, "hsa-mir-106a"=>51, "hsa-mir-210"=>52, "hsa-mir-181c"=>53, "hsa-mir-150"=>54, "hsa-mir-32"=>55, "hsa-let-7a-1"=>56, "hsa-mir-100"=>57, "hsa-let-7a-2"=>58, "hsa-mir-346"=>59, "hsa-mir-15a"=>60, "hsa-mir-195"=>61, "hsa-let-7a-3"=>62, "hsa-mir-200c"=>63, "hsa-mir-103-1"=>64, "hsa-mir-99b"=>65, "hsa-mir-20b"=>66, "hsa-mir-15b"=>67, "hsa-mir-301a"=>68, "hsa-mir-33a"=>69, "hsa-mir-140"=>70, "hsa-mir-128-2"=>71, "hsa-mir-9-1"=>72, "hsa-mir-212"=>73, "hsa-mir-10a"=>74, "hsa-mir-379"=>75, "hsa-mir-218-1"=>76, "hsa-mir-136"=>77, "hsa-mir-378"=>78, "hsa-mir-185"=>79, "hsa-mir-221"=>80, "hsa-mir-129-1"=>81, "hsa-mir-370"=>82, "hsa-mir-18a"=>83, "hsa-mir-199b"=>84, "hsa-mir-127"=>85, "hsa-mir-146a"=>86, "hsa-mir-146b"=>87, "hsa-mir-409"=>88, "hsa-mir-196a-1"=>89, "hsa-mir-92a-1"=>90, "hsa-mir-23a"=>91, "hsa-mir-198"=>92, "hsa-mir-365-1"=>93, "hsa-mir-199a-1"=>94, "hsa-mir-214"=>95, "hsa-let-7d"=>96, "hsa-mir-383"=>97, "hsa-mir-96"=>98, "hsa-mir-376a-1"=>99, "hsa-mir-184"=>100, "hsa-mir-25"=>101, "hsa-mir-130a"=>102, "hsa-mir-429"=>103, "hsa-mir-135b"=>104, "hsa-mir-135a-1"=>105, "hsa-mir-21"=>106, "hsa-mir-24-1"=>107, "hsa-mir-26b"=>108, "hsa-mir-95"=>109, "hsa-mir-133a-1"=>110, "hsa-mir-133a-2"=>111, "mmu-mir-133a-2"=>112, "hsa-mir-223"=>113, "hsa-mir-125b-1"=>114, "hsa-mir-181b-2"=>115, "hsa-mir-181b-1"=>116, "hsa-mir-335"=>117, "hsa-mir-29c"=>118, "hsa-mir-9-2"=>119, "hsa-mir-30b"=>120, "hsa-mir-34b"=>121, "hsa-mir-30d"=>122, "hsa-mir-29b-1"=>123, "hsa-mir-371"=>124, "hsa-mir-19b-1"=>125, "hsa-mir-106b"=>126, "hsa-mir-29a"=>127, "hsa-mir-101-1"=>128, "hsa-mir-22"=>129, "hsa-mir-30a"=>130, "hsa-mir-124-1"=>131, "hsa-mir-520h"=>132, "hsa-mir-497"=>133, "hsa-mir-363"=>134, "hsa-mir-199a-2"=>135, "hsa-let-7i"=>136, "hsa-mir-7-3"=>137, "hsa-mir-126"=>138, "hsa-mir-34a"=>139, "hsa-mir-320a"=>140, "hsa-mir-517b"=>141, "hsa-mir-194-1"=>142, "hsa-mir-149"=>143, "hsa-mir-216a"=>144, "hsa-mir-338"=>145, "hsa-mir-298"=>146, "hsa-mir-124-3"=>147, "hsa-let-7g"=>148, "hsa-mir-452"=>149, 
"hsa-mir-125a"=>150,"hsa-let-7f-2"=>151, "hsa-mir-28"=>152, "hsa-mir-340"=>153, "hsa-mir-17"=>154, "hsa-mir-345"=>155, "hsa-mir-483"=>156, "hsa-mir-488"=>157, "hsa-mir-511-1"=>158, "hsa-mir-181a-2"=>159, "hsa-mir-424"=>160, "hsa-mir-495"=>161, "hsa-mir-132"=>162, "hsa-mir-302d"=>163, "hsa-let-7b"=>164, "hsa-mir-153-1"=>165, "hsa-mir-142"=>166, "hsa-mir-422a"=>167, "hsa-mir-200b"=>168, "hsa-mir-34c"=>169, "hsa-mir-299"=>170, "hsa-mir-7-1"=>171, "hsa-mir-372"=>172, "hsa-mir-211"=>173, "hsa-mir-186"=>174, "hsa-mir-331"=>175, "hsa-mir-501"=>176, "hsa-mir-188"=>177, "hsa-mir-302a"=>178, "hsa-mir-107"=>179, "hsa-mir-330"=>180, "hsa-mir-200a"=>181, "hsa-mir-190"=>182, "hsa-mir-30c-2"=>183, "hsa-mir-129-2"=>184, "hsa-mir-181a-1"=>185, "hsa-mir-10b"=>186, "hsa-mir-567"=>187, "hsa-mir-191"=>188, "hsa-mir-487b"=>189, "hsa-mir-206"=>190, "hsa-mir-181d"=>191, "hsa-mir-326"=>192, "hsa-mir-496"=>193, "hsa-mir-135a-2"=>194, "hsa-mir-601"=>195, "hsa-mir-542"=>196, "hsa-mir-627"=>197, "hsa-mir-128-1"=>198, "hsa-mir-657"=>199, "hsa-mir-455"=>200, "hsa-mir-515-1"=>201, "hsa-mir-329-1"=>202, "hsa-mir-663"=>203, "hsa-mir-296"=>204, "hsa-mir-572"=>205, "hsa-mir-381"=>206, "hsa-mir-498"=>207, "hsa-mir-411"=>208, "hsa-mir-154"=>209, "hsa-mir-361"=>210, "mmu-mir-106a"=>211, "mmu-mir-363"=>212, "hsa-mir-516b-1"=>213, "hsa-let-7f-1"=>214, "hsa-mir-635"=>215, "hsa-mir-502"=>216, "hsa-mir-611"=>217, "hsa-mir-152"=>218, "hsa-mir-376c"=>219, "hsa-mir-448"=>220, "hsa-mir-151"=>221, "hsa-mir-605"=>222, "hsa-mir-204"=>223, "hsa-mir-551a"=>224, "hsa-mir-98"=>225, "hsa-mir-637"=>226, "hsa-mir-302b"=>227, "hsa-mir-451"=>228, "hsa-mir-500"=>229, "hsa-miR-320"=>230, "hsa-mir-449b"=>231, "hsa-mir-520a"=>232, "hsa-mir-217"=>233, "hsa-mir-193b"=>234, "hsa-mir-141"=>235, "hsa-mir-518f"=>236, "hsa-mir-513a-1"=>237, "hsa-mir-193a"=>238, "hsa-mir-375"=>239, "hsa-mir-449a"=>240, "hsa-mir-362"=>241, "hsa-mir-486"=>242, "hsa-mir-337"=>243, "hsa-mir-105-1"=>244, "hsa-mir-518b"=>245, "hsa-mir-517a"=>246, "hsa-mir-526a-1"=>247, "hsa-mir-518a-2"=>248, "hsa-mir-192"=>249, "hsa-mir-27b"=>250, "hsa-mir-134"=>251, "hsa-mir-325"=>252, "hsa-mir-642"=>253, "hsa-mir-494"=>254, "hsa-mir-1-1"=>255, "hsa-mir-432"=>256, "hsa-mir-608"=>257, "hsa-mir-130b"=>258, "hsa-mir-16-2"=>259, "hsa-mir-133b"=>260, "hsa-mir-423"=>261, "hsa-let-7c"=>262, "hsa-mir-139"=>263, "hsa-let-7e"=>264, "hsa-mir-202"=>265, "hsa-mir-493"=>266, "hsa-mir-144"=>267, "hsa-mir-519d"=>268, "hsa-mir-369"=>269, "hsa-mir-138-2"=>270, "hsa-mir-499"=>271, "hsa-mir-382"=>272, "hsa-mir-103-2"=>273, "hsa-mir-508"=>274, "hsa-mir-648"=>275, "mmu-mir-700"=>276, "mmu-mir-20b"=>277, "hsa-mir-519a-1"=>278, "hsa-mir-485"=>279, "hsa-mir-218-2"=>280, "hsa-mir-599"=>281, "hsa-mir-18b"=>282, "mmu-mir-298"=>283, "mmu-mir-23b"=>284, "mmu-mir-23a"=>285, "mmu-mir-27b"=>286, "hsa-mir-194-2"=>287, "hsa-mir-886"=>288, "hsa-mir-489"=>289, "mmu-mir-351"=>290, "mmu-mir-467a"=>291, "hsa-mir-425"=>292, "hsa-mir-516a-1"=>293, "hsa-mir-524"=>294, "mmu-mir-210"=>295,
 "mmu-mir-22"=>296, "mmu-mir-365-1"=>297, "hsa-miR-125b"=>298, "hsa-miR-9"=>299, "mmu-mir-18a"=>300, "mmu-mir-33"=>301, "mmu-mir-140"=>302, "mmu-mir-30b"=>303, "mmu-mir-361"=>304, "hsa-mir-196a-2"=>305, "mmu-mir-148b"=>306, "mmu-mir-193b"=>307, "mmu-mir-222"=>308, "hsa-mir-26a-2"=>309, "mmu-mir-25"=>310, "mmu-mir-503"=>311, "mmu-mir-296"=>312, "mmu-mir-223"=>313, "mmu-mir-669c"=>314, "mmu-mir-805"=>315, "mmu-mir-652"=>316, "mmu-mir-674"=>317, "hsa-miR-29b"=>318, "mmu-mir-196b"=>319, "mmu-mir-301a"=>320, "mmu-mir-376b"=>321, "hsa-miR-30c"=>322, "mmu-mir-126"=>323, "mmu-mir-21"=>324, "mmu-mir-16-1"=>325, "mmu-mir-450b"=>326, "hsa-mir-582"=>327, "hsa-mir-1226"=>328, "mmu-mir-7a-1"=>329, "hsa-miR-338-3p"=>330, "mmu-mir-15a"=>331, "hsa-mir-377"=>332, "mmu-mir-10a"=>333, "mmu-mir-877"=>334, "hsa-miR-7"=>335, "mmu-mir-342"=>336, "mmu-let-7b"=>337, "hsa-mir-373"=>338, "mmu-mir-128-1"=>339, "hsa-mir-659"=>340, "mmu-mir-27a"=>341, "mmu-mir-192"=>342, "mmu-mir-139"=>343, "mmu-mir-29c"=>344, "mmu-mir-203"=>345, "mmu-mir-146a"=>346, "mmu-mir-320"=>347, "mmu-mir-137"=>348, "mmu-mir-542"=>349, "mmu-mir-338"=>350, "hsa-mir-622"=>351, "hsa-mir-147"=>352, "mmu-mir-328"=>353, "mmu-mir-191"=>354, "hsa-mir-421"=>355, "hsa-mir-526b"=>356, "hsa-mir-491"=>357, "hsa-mir-658"=>358, "hsa-miR-139-5p"=>359, "hsa-mir-512-1"=>360, "hsa-miR-768-3p"=>361, "hsa-mir-208a"=>362, "hsa-mir-410"=>363, "hsa-mir-518c"=>364, "mmu-mir-339"=>365, "hsa-mir-510"=>366, "hsa-mir-450a-1"=>367, "hsa-mir-525"=>368, "mmu-mir-155"=>369, "mmu-let-7i"=>370, "hsa-mir-584"=>371, "mmu-miR-30c"=>372, "mmu-miR-9"=>373, "mmu-miR-409-3p"=>374, "mmu-mir-181c"=>375, "hsa-mir-1275"=>376, "hsa-mir-1307"=>377, "hsa-mir-874"=>378, "mmu-mir-20a"=>379, "hsa-mir-376b"=>380, "hsa-mir-29b-2"=>381, "mmu-mir-337"=>382, "mmu-mir-31"=>383, "hsa-miR-491-5p"=>384, "hsa-mir-662"=>385, "hsa-mir-664"=>386, "hsa-mir-625"=>387, "hsa-mir-433"=>388, "hsa-mir-548o"=>389, "hsa-mir-454"=>390, "hsa-miR-142-3p"=>391, "hsa-mir-520d"=>392, "hsa-mir-412"=>393, "mmu-mir-29a"=>394, "hsa-mir-523"=>395, "mmu-mir-133b"=>396, "hsa-mir-766"=>397, "hsa-mir-590"=>398, "mmu-mir-712"=>399, "mmu-mir-500"=>400, "hsa-mir-649"=>401, "mmu-mir-370"=>402, "mmu-mir-181a-1"=>403, "hsa-mir-646"=>404, "mmu-let-7d"=>405, "mmu-mir-292"=>406, "mmu-mir-30e"=>407, "hsa-mir-520c"=>408, "mmu-mir-681"=>409, "mmu-mir-150"=>410, "mmu-mir-10b"=>411, "hsa-mir-617"=>412, "mmu-mir-130b"=>413, "hsa-mir-19b-2"=>414, "mmu-mir-19b-1"=>415, "mmu-mir-468"=>416, "hsa-mir-520b"=>417, "hsa-mir-539"=>418, "hsa-mir-487a"=>419, "mmu-mir-290"=>420, "hsa-mir-509-1"=>421, "hsa-mir-639"=>422, "mmu-mir-143"=>423, "mmu-mir-680-1"=>424, "hsa-mir-708"=>425, "mmu-mir-9-1"=>426, "hsa-mir-124-2"=>427, "hsa-mir-644"=>428, "mmu-mir-346"=>429, "mmu-mir-669a-1"=>430, "mmu-mir-182"=>431, "mmu-mir-125a"=>432, "mmu-mir-378"=>433, "hsa-mir-33b"=>434, "mmu-mir-322"=>435, "mmu-mir-486"=>436, "mmu-mir-145"=>437, "hsa-mir-660"=>438, "mmu-mir-685"=>439, "hsa-mir-507"=>440, "mmu-mir-184"=>441,
 "mmu-mir-99a"=>442, "mmu-mir-706"=>443, "mmu-mir-100"=>444, "mmu-mir-106b"=>445, "hsa-mir-532"=>446, "hsa-mir-484"=>447, "mmu-mir-691"=>448, "mmu-mir-711"=>449, "mmu-mir-466a"=>450, "mmu-mir-686"=>451, "hsa-mir-574"=>452, "mmu-mir-17"=>453, "mmu-mir-125b-1"=>454, "hsa-mir-505"=>455, "mmu-mir-714"=>456, "hsa-miR-550"=>457, "mmu-mir-721"=>458, "hsa-mir-604"=>459, "mmu-mir-710"=>460, "hsa-mir-92b"=>461, "mmu-mir-699"=>462, "hsa-mir-650"=>463, "mmu-mir-207"=>464, "hsa-mir-503"=>465, "hsa-mir-550-1"=>466, "hsa-miR-26a"=>467, "hsa-mir-767"=>468, "hsa-mir-576"=>469, "hsa-mir-888"=>470, "hsa-mir-571"=>471, "mmu-mir-199b"=>472, "hsa-mir-566"=>473, "hsa-mir-891a"=>474, "hsa-mir-518e"=>475, "hsa-mir-557"=>476, "hsa-mir-519b"=>477, "hsa-mir-509-3"=>478, "hsa-mir-632"=>479, "hsa-mir-593"=>480, "mmu-mir-375"=>481, "hsa-mir-630"=>482, "hsa-mir-621"=>483, "mmu-mir-93"=>484, "hsa-mir-105-2"=>485, "hsa-mir-153-2"=>486, "hsa-mir-219-2"=>487, "hsa-mir-612"=>488, "hsa-mir-769"=>489, "hsa-mir-615"=>490, "hsa-mir-596"=>491, "hsa-mir-1249"=>492, "mmu-mir-92a-1"=>493, "hsa-mir-652"=>494, "hsa-miR-32*"=>495, "hsa-mir-629"=>496, "hsa-mir-602"=>497, "hsa-mir-583"=>498, "hsa-mir-638"=>499, "hsa-mir-600"=>500, "hsa-mir-374b"=>501, "hsa-mir-9-3"=>502, "hsa-mir-575"=>503, "hsa-mir-654"=>504, "hsa-mir-877"=>505, "hsa-mir-384"=>506, "hsa-mir-101-2"=>507, "hsa-mir-365-2"=>508, "hsa-mir-1224"=>509, "hsa-mir-513b"=>510, "hsa-mir-892b"=>511, "hsa-mir-923"=>512, "hsa-mir-1225"=>513, "hsa-mir-765"=>514, "hsa-mir-873"=>515, "hsa-mir-760"=>516, "hsa-mir-939"=>517, "hsa-mir-564"=>518, "hsa-mir-758"=>519, "hsa-mir-623"=>520);

$mirna_array = array();                                                                                           
$lineCount = 0;                                                                                                   
                                                                                                                  
if($influenceMethodSelected == 'Cumulative Union' and $netGenMethod == 'All edges above 0.9 score, rescored to 0.01')                                                                
 {                                                                                                                
   $topmiRlimit = 10;
   $use_hashmap_flag = 1;                                                                                             
   
   if($disCategorySelected == 'Endocrine cancers')  { $fp = fopen('php-files/EndocrineCumulative_0_05.txt','r'); }
   if($disCategorySelected == 'Gastrointestinal cancers')  { $fp = fopen('php-files/GastrointestinalCumulative_0_05.txt','r'); }
   if($disCategorySelected == 'Brain systems')  { $fp = fopen('php-files/BrainCumulative_0_05.txt','r'); }
   if($disCategorySelected == 'Leukemia cancers')  { $fp = fopen('php-files/LeukemiaCumulative_0_05.txt','r'); }
 }                                                                                                                
                                                                                                                  
else if($influenceMethodSelected == 'Cumulative Union' and $netGenMethod == 'Optimized network based on expression scores')                                                                
 {                                                                                                                
   $topmiRlimit = 10;                                                                                             
   
   if($disCategorySelected == 'Endocrine cancers')  { $fp = fopen('php-files/EndocrineCumulative.txt','r'); }
   if($disCategorySelected == 'Gastrointestinal cancers')  { $fp = fopen('php-files/GastrointestinalCumulative.txt','r'); }
   if($disCategorySelected == 'Brain systems')  { $fp = fopen('php-files/BrainCumulative.txt','r'); }
   if($disCategorySelected == 'Leukemia cancers')  { $fp = fopen('php-files/LeukemiaCumulative.txt','r'); }
 }  
                                                                                                              
else if($influenceMethodSelected == 'Intersection (Logical AND) approach' and $netGenMethod == 'All edges above 0.9 score, rescored to 0.01')                                                                                                              
 {  
   $topmiRlimit = 5;
   $use_hashmap_flag = 1;                                                                                              
   
   if($disCategorySelected == 'Endocrine cancers')  { $fp = fopen('php-files/EndocrineIntersection_0_05.txt','r'); }
   if($disCategorySelected == 'Gastrointestinal cancers')  { $fp = fopen('php-files/GastrointestinalIntersection_0_05.txt','r'); $topmiRlimit = 3; }
   if($disCategorySelected == 'Brain systems')  { $fp = fopen('php-files/BrainIntersection_0_05.txt','r'); }
   if($disCategorySelected == 'Leukemia cancers')  { $fp = fopen('php-files/LeukemiaIntersection_0_05.txt','r'); }
 }

else // i.e. influenceMethodSelected == Intersection and $netGenMethod == optimized network based on expression scores
 {  
   $topmiRlimit = 5;                                                                                              
   
   if($disCategorySelected == 'Endocrine cancers')  { $fp = fopen('php-files/EndocrineIntersection.txt','r'); }
   if($disCategorySelected == 'Gastrointestinal cancers')  { $fp = fopen('php-files/GastrointestinalIntersection.txt','r'); $topmiRlimit = 3; }
   if($disCategorySelected == 'Brain systems')  { $fp = fopen('php-files/BrainIntersection.txt','r'); }
   if($disCategorySelected == 'Leukemia cancers')  { $fp = fopen('php-files/LeukemiaIntersection.txt','r'); }
 }
                                                                                                                  
 while ($lineCount<$topmiRlimit and $use_hashmap_flag == 0)                                                                                  
   {                                                                                                              
     $line = fgets($fp, 2048); // gets the 1st line of the file                                                   
     $data = str_getcsv($line," ");  // splits the line into two entities separated by space                      
    // $mirna_name = array_search($data[0],$mirna_int_hashmap); //Searches for the miRNA name based on the number   
     array_push($mirna_array, $data[0]);                                                                       
     $lineCount = $lineCount+1;                                                                                   
   }  
                                                                                                             
 while ($lineCount<$topmiRlimit and $use_hashmap_flag == 1)                                                                                  
   {                                                                                                              
     $line = fgets($fp, 2048); // gets the 1st line of the file                                                   
     $data = str_getcsv($line," ");  // splits the line into two entities separated by space                      
     $mirna_name = array_search($data[0],$mirna_int_hashmap); //Searches for the miRNA name based on the number   
     array_push($mirna_array, $mirna_name);                                                                       
     $lineCount = $lineCount+1;                                                                                   
   }  
                                                                                                                  
  echo json_encode($mirna_array); //Send it back to index.php page                                                

?>
